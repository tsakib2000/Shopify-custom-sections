{% stylesheet %}
  .how-it-works-section {
    background-color: #426D58;
    color: #ffffff;
    padding: 60px 0;
  }
  .o-btn {
    position: relative;
    left: -167px;
  }
  .how-it-works-heading {
    text-align: center;
    font-size: 36px;
    font-weight: bold;
    margin-bottom: 30px;
  }
  .how-it-works-steps {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-bottom: 60px;
    cursor: pointer;
  }
  .how-it-works-step {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    text-align: center;
    color: #aaa;
    transition: color 0.3s ease;
  }
  .how-it-works-step span {
    display: block;
    font-size: 20px;
    font-weight: 600;
    background-color: #EDEAE3;
    color: #888;
    width: 60px;
    height: 60px;
    line-height: 35px;
    border-radius: 50%;
    margin: 0 auto 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  .how-it-works-step.active {
    color: white;
  }
  .how-it-works-step.active span {
    background-color: white;
    color: #426D58;
  }
  .how-it-works-step:hover {
    color: white;
  }
  .how-it-works-step:hover span {
    background-color: white;
    color: #426D58;
  }
  .how-it-works-body {
    display: flex;
    align-items: center;
    justify-content: center;
    max-width: 1000px;
    margin: 0 auto;
    background: white;
    border-radius: 20px;
    overflow: hidden;
  }
  .how-it-works-left,
  .how-it-works-right {
    flex: 1;
    padding: 40px;
  }
  .how-it-works-left video {
    width: 100%;
    border-radius: 10px;
  }
  .how-it-works-right h2,
  .how-it-works-right p {
    color: #000;
  }
  .how-it-works-right h2 {
    font-size: 20px;
    margin-bottom: 10px;
  }
  .how-it-works-right img {
    max-width: 150px;
    height: auto;
    margin-bottom: 20px;
  }
  .how-it-works-right p {
    font-size: 14px;
    margin-bottom: 20px;
    max-width: 300px;
  }
  .how-it-works-right .btn {
    background-color: #426D58;
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    display: inline-block;
    text-decoration: none;
    font-weight: 600;
  }
  .how-it-works-right .btn:hover {
    background-color: white;
    color: #426D58;
  }
  .step {
    font-size: 20px;
  }
  .o-btn.is-secondary {
    background: #ffffff;
    color: black;
    border-radius: 100%;
    width: 60px;
    height: 60px;
    cursor: pointer;
    padding: 40px;
    font-size: 20px;
    border: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    position: relative;
    bottom: 65px;
  }
  @media (max-width: 768px) {
    .step {
      display: none;
    }
    .how-it-works-body {
      flex-direction: column;
    }
    .how-it-works-right {
      display: none;
    }
    .how-it-works-left {
      padding: 20px;
    }
  }
{% endstylesheet %}

<section class="how-it-works-section">
  <div class="how-it-works-heading">{{ section.settings.heading }}</div>

  <div class="how-it-works-steps">
    <div class="how-it-works-step active" data-step="1">
      <span>1</span>
      <div class="step">{{ section.settings.step1_title }}</div>
    </div>
    <div class="how-it-works-step" data-step="2">
      <span>2</span>
      <div class="step">{{ section.settings.step2_title }}</div>
    </div>
    <div class="how-it-works-step" data-step="3">
      <span>3</span>
      <div class="step">{{ section.settings.step3_title }}</div>
    </div>
  </div>

  <div class="how-it-works-body">
    <div class="how-it-works-left">
      <video
        id="howItWorksVideo"
        autoplay
        muted
        loop
        playsinline
        poster="{{ section.settings.video_poster | image_url }}"
        class="c-instructional-content_video lazy"
      >
        <source data-src="{{ section.settings.video_url }}" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <div class="c-instructional-content_video-btn" style="margin-top: 15px; text-align: center; border-radius:50%;">
        <button
          id="togglePlayBtn"
          onmouseover="this.style.backgroundColor='#F5F2F0';"
          onmouseout="this.style.backgroundColor='white';"
          class="o-btn is-secondary"
        >
          ▶
        </button>
      </div>
    </div>

    <div class="how-it-works-right">
      <h2 id="step-heading">{{ section.settings.step1_title }}</h2>
      <img id="step-image" src="{{ section.settings.step1_image | image_url }}" alt="Step image">
      <p id="step-description">{{ section.settings.step1_desc }}</p>
      <a href="{{ section.settings.step1_link }}" class="btn" id="step-button">{{ section.settings.step1_button_label }}</a>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const steps = document.querySelectorAll(".how-it-works-step");
    const heading = document.getElementById("step-heading");
    const description = document.getElementById("step-description");
    const button = document.getElementById("step-button");
    const image = document.getElementById("step-image");

    const content = {
      1: {
        title: "{{ section.settings.step1_title | escape }}",
        desc: "{{ section.settings.step1_desc | escape }}",
        url: "{{ section.settings.step1_link }}",
        img: "{{ section.settings.step1_image | image_url }}"
      },
      2: {
        title: "{{ section.settings.step2_title | escape }}",
        desc: "{{ section.settings.step2_desc | escape }}",
        url: "{{ section.settings.step2_link }}",
        img: "{{ section.settings.step2_image | image_url }}"
      },
      3: {
        title: "{{ section.settings.step3_title | escape }}",
        desc: "{{ section.settings.step3_desc | escape }}",
        url: "{{ section.settings.step3_link }}",
        img: "{{ section.settings.step3_image | image_url }}"
      }
    };

    steps.forEach(step => {
      step.addEventListener("click", () => {
        steps.forEach(s => s.classList.remove("active"));
        step.classList.add("active");

        const index = step.dataset.step;
        heading.textContent = content[index].title;
        description.textContent = content[index].desc;
        button.setAttribute("href", content[index].url);
        image.setAttribute("src", content[index].img);
        button.textContent = content[index].title;
      });
    });

    const lazyVideos = [].slice.call(document.querySelectorAll("video.lazy"));
    if ("IntersectionObserver" in window) {
      const lazyVideoObserver = new IntersectionObserver(function (entries, observer) {
        entries.forEach(function (entry) {
          if (entry.isIntersecting) {
            const video = entry.target;
            for (let source of video.children) {
              if (source.tagName === "SOURCE") {
                source.src = source.dataset.src;
              }
            }
            video.load();
            video.classList.remove("lazy");
            lazyVideoObserver.unobserve(video);
          }
        });
      });
      lazyVideos.forEach(function (lazyVideo) {
        lazyVideoObserver.observe(lazyVideo);
      });
    }

    const toggleButton = document.getElementById('togglePlayBtn');
    const videoElement = document.getElementById('howItWorksVideo');

    if (toggleButton && videoElement) {
      toggleButton.addEventListener('click', function () {
        if (videoElement.paused) {
          videoElement.play();
          toggleButton.innerHTML = '❚❚';
        } else {
          videoElement.pause();
          toggleButton.innerHTML = '▶';
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "How It Works Section",
  "tag": "section",
  "class": "shopify-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "How it works"
    },
    {
      "type": "url",
      "id": "video_url",
      "label": "Video URL (.mp4)"
    },
    {
      "type": "image_picker",
      "id": "video_poster",
      "label": "Video Poster Image"
    },

    {
      "type": "text",
      "id": "step1_title",
      "label": "Step 1 Title",
      "default": "Shop our samples"
    },
    {
      "type": "textarea",
      "id": "step1_desc",
      "label": "Step 1 Description",
      "default": "Custom-made curtains and blinds, delivered right to your door."
    },
    {
      "type": "url",
      "id": "step1_link",
      "label": "Step 1 Button Link"
    },
    {
      "type": "text",
      "id": "step1_button_label",
      "label": "Step 1 Button Label",
      "default": "Shop samples"
    },
    {
      "type": "image_picker",
      "id": "step1_image",
      "label": "Step 1 Image"
    },

    {
      "type": "text",
      "id": "step2_title",
      "label": "Step 2 Title",
      "default": "Measure and customise"
    },
    {
      "type": "textarea",
      "id": "step2_desc",
      "label": "Step 2 Description"
    },
    {
      "type": "url",
      "id": "step2_link",
      "label": "Step 2 Button Link"
    },
    {
      "type": "text",
      "id": "step2_button_label",
      "label": "Step 2 Button Label",
      "default": "Get started"
    },
    {
      "type": "image_picker",
      "id": "step2_image",
      "label": "Step 2 Image"
    },

    {
      "type": "text",
      "id": "step3_title",
      "label": "Step 3 Title",
      "default": "Delivered ready to install"
    },
    {
      "type": "textarea",
      "id": "step3_desc",
      "label": "Step 3 Description"
    },
    {
      "type": "url",
      "id": "step3_link",
      "label": "Step 3 Button Link"
    },
    {
      "type": "text",
      "id": "step3_button_label",
      "label": "Step 3 Button Label",
      "default": "Learn more"
    },
    {
      "type": "image_picker",
      "id": "step3_image",
      "label": "Step 3 Image"
    }
  ],
  "presets": [
    {
      "name": "How It Works",
      "category": "Custom"
    }
  ]
}
{% endschema %}
